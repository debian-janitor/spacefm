From e0d0e9f7c47c0e7125b4e1e035b3da8be23ad3c1 Mon Sep 17 00:00:00 2001
From: Justin Kinnaird <jkinnaird1991@gmail.com>
Date: Thu, 16 Feb 2017 00:17:56 -0600
Subject: [PATCH] Try to load using full icon-name if removing the suffix
 returns a null icon. Fixes: IgnorantGuru#647

---
 src/vfs/vfs-app-desktop.c | 6 +++++-
 src/vfs/vfs-utils.c       | 2 --
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/src/vfs/vfs-app-desktop.c b/src/vfs/vfs-app-desktop.c
index 0892403..44d220f 100644
--- a/src/vfs/vfs-app-desktop.c
+++ b/src/vfs/vfs-app-desktop.c
@@ -241,7 +241,7 @@ GdkPixbuf* vfs_app_desktop_get_icon( VFSAppDesktop* app, int size, gboolean use_
         else
         {
             theme = gtk_icon_theme_get_default();
-            suffix = strchr( app->icon_name, '.' );
+            suffix = strrchr( app->icon_name, '.' );
             if( suffix ) /* has file extension, it's a basename of icon file */
             {
                 /* try to find it in pixmaps dirs */
@@ -253,6 +253,10 @@ GdkPixbuf* vfs_app_desktop_get_icon( VFSAppDesktop* app, int size, gboolean use_
                     icon_name = g_strndup( app->icon_name,
                                            (suffix - app->icon_name) );
                     icon = vfs_load_icon( theme, icon_name, size );
+                    if (icon == NULL) {
+                        //Try to lookup with full name instead.
+                        icon = vfs_load_icon(theme, app->icon_name, size);
+                    }
                     g_free( icon_name );
                 }
             }
diff --git a/src/vfs/vfs-utils.c b/src/vfs/vfs-utils.c
index 96190c5..432826b 100644
--- a/src/vfs/vfs-utils.c
+++ b/src/vfs/vfs-utils.c
@@ -32,11 +32,9 @@ GdkPixbuf* vfs_load_icon( GtkIconTheme* theme, const char* icon_name, int size )
 
     if ( !icon_name )
         return NULL;
-
     GtkIconInfo* inf = gtk_icon_theme_lookup_icon( theme, icon_name, size,
                                              GTK_ICON_LOOKUP_USE_BUILTIN |
                                              GTK_ICON_LOOKUP_FORCE_SIZE );
-
     if ( !inf && icon_name[0] == '/' )
         return gdk_pixbuf_new_from_file_at_size ( icon_name, size, size, NULL );
     
